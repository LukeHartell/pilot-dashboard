<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Preflight | Pilot Dashboard</title>
    <link rel="icon" href="assets/img/favicon.ico" />
    <link rel="stylesheet" href="assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/layout.css" />
    <link rel="stylesheet" href="assets/css/nav.css" />
    <link rel="stylesheet" href="assets/css/darkmode.css" />
    <link rel="stylesheet" href="assets/css/widgets.css" />
    <link rel="stylesheet" href="assets/css/preflight.css" />
    <script defer src="assets/js/header.js"></script>
    <!-- Injects header dynamically -->
    <script defer src="assets/js/user-menu.js"></script>
    <!-- Updates user menu -->
  </head>
  <body>
    <div class="scaling-wrapper">
      <!-- Header will be injected here -->

      <main>
        <section id="preflight">
          <h2>Preflight Briefing</h2>
          <div id="preflightGrid" class="widget-grid">
            <!-- TILE: AIRBASE -->
            <div class="widget" id="airbaseWidget">
              <div class="widget-buttons">
                <!-- <button class="edit-btn" title="Edit">‚úèÔ∏è</button> -->
                <button class="fullscreen-btn" title="Fullscreen">‚õ∂</button>
              </div>

              <h3>üìç Airbase</h3>
              <form id="icaoForm" action="#" autocomplete="off">
                <input
                  type="text"
                  id="icao"
                  name="icao"
                  placeholder="ICAO Code"
                  required
                  pattern="[A-Za-z]{4}"
                  maxlength="4"
                  style="text-transform: uppercase" />
                <button type="submit">Select Airbase</button>
              </form>
              <div id="airbaseInfo"></div>
              <div id="mapContainer"></div>
            </div>

            <!-- TILE: METAR / TAF -->
            <div class="widget" id="metarWidget" style="display: none">
              <div class="widget-buttons">
                <button class="fullscreen-btn" title="Fullscreen">‚õ∂</button>
              </div>

              <h3>üõ∞Ô∏è METAR / TAF</h3>

              <div class="toggle-buttons">
                <button
                  type="button"
                  class="metar-toggle"
                  data-target="visual"
                  disabled>
                  Visual
                </button>
                <button type="button" class="metar-toggle" data-target="raw">
                  Raw
                </button>
              </div>

              <div id="metarRawSection" style="display: none">
                <div id="metarResult"></div>
              </div>

              <div id="metarVisualSection">
                <a
                  href="https://metar-taf.com/EKSP"
                  id="metartaf-v7exxgfd"
                  class="metar-embed-link">
                  METAR Skrydstrup Air Base
                </a>
              </div>

              <div id="metarIframeFullscreen" style="display: none">
                <div class="iframe-container">
                  <iframe
                    id="metarIframe"
                    src=""
                    loading="lazy"
                    frameborder="0"></iframe>
                </div>
              </div>
            </div>

            <!-- TILE: Flight Assistant -->
            <div class="widget" id="assistantWidget">
              <div class="widget-buttons">
                <!-- <button class="edit-btn" title="Edit">‚úèÔ∏è</button> -->
                <button class="fullscreen-btn" title="Fullscreen">‚õ∂</button>
              </div>
              <h3>üß† Flight Assistant</h3>
              <button id="getFlightAssistantBtn" disabled>
                Get AI Summary
              </button>
              <div id="assistantOutputWrapper">
                <div id="assistantOutput"></div>
                <div class="fade-out"></div>
              </div>
            </div>

            <!-- TILE: NOTAMs -->
            <div class="widget" style="display: none">
              <div class="widget-buttons">
                <!-- <button class="edit-btn" title="Edit">‚úèÔ∏è</button> -->
                <button class="fullscreen-btn" title="Fullscreen">‚õ∂</button>
              </div>

              <h3>‚ö†Ô∏è NOTAMs</h3>
              <p>Widget coming soon...</p>
            </div>

            <!-- TILE: Thermals -->
            <div class="widget" id="thermalsWidget">
              <div class="widget-buttons">
                <!-- <button class="edit-btn" title="Edit">‚úèÔ∏è</button> -->
                <button class="fullscreen-btn" title="Fullscreen">‚õ∂</button>
              </div>
              <h3>üå§Ô∏è Thermals</h3>
              <div class="map-lock">
                <iframe
                  id="thermalsMap"
                  src="https://rasp.skyltdirect.se/scandinavia/"
                  loading="lazy"
                  frameborder="0"
                  allowfullscreen></iframe>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Modals -->
    <div id="widgetModal">
      <div class="modal-content">
        <button class="close-modal" id="closeModalBtn" title="Close">‚úï</button>
        <div id="modalContent"></div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/nav.js"></script>
    <script src="assets/js/preflight.js"></script>
    <!-- <script src="assets/js/darkmode.js"></script> -->
    <script
      async
      defer
      crossorigin="anonymous"
      src="https://metar-taf.com/embed-js/EKSP?layout=landscape&qnh=hPa&rh=rh&target=IKYQpZ7R"></script>
  </body>
</html>
